<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ratio splitter</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#000000; --muted:#333333; --card:#f5f7fb;
      --blue:#1e88e5; /* left */
      --yellow:#ffd54f; /* right */
      --border:#0c1024; --divider:#000; --panel:#fafafa;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:960px;margin:28px auto;padding:0 16px}

    header{display:flex;align-items:center;justify-content:center;margin-bottom:14px}
    header h1{font-size:26px;margin:0 0 4px 0;color:#000000}

    .card{background:#fff;border:1px solid #e3e6ef;border-radius:16px;box-shadow:0 6px 22px rgba(0,0,0,.06)}

    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:14px}
    .controls .btn{appearance:none;border:1px solid #bbb;background:#fff;color:#111;
      padding:9px 14px;border-radius:12px;cursor:pointer}
    .controls .btn[disabled]{opacity:.45;cursor:not-allowed}
    .controls .btn:hover:not([disabled]){background:#f6f6f6}
    .controls .btn:active:not([disabled]){transform:translateY(1px)}
    .controls .btn.primary{border-color:#888}
    .controls .info{margin-left:auto;color:#444;font-size:13px}

    .viz{padding:18px 16px 8px}

    /* Top counters above the bar */
    .counters{position:relative;display:flex;gap:0;margin-bottom:8px}
    .counter-slot{flex:1;display:flex;justify-content:center}
    .counter{width:88px;max-width:90%; text-align:center; padding:10px 12px; border-radius:10px; border:1px solid #bbbbbb; background:#ffffff; color:#000000; font-size:32px; font-weight:600}

    /* Bar area */
    .barWrap{position:relative;border-radius:16px;border:3px solid #0f1328;background:#0b1020;padding:12px}
    .bar{position:relative;height:56px;border-radius:10px;overflow:visible;background:#0b0f24;border:2px solid var(--border)}
    .bar .leftFill, .bar .rightFill{position:absolute;top:0;bottom:0;z-index:1}
    .bar .leftFill{left:0;background:var(--blue)}
    .bar .rightFill{right:0;background:var(--yellow)}

    /* Partition lines container */
    .bar .lines{position:absolute;inset:0;pointer-events:none;z-index:2}
    .bar .lines .v{position:absolute;top:0;bottom:0;width:1px;background:#000}

    /* Per-part labels */
    .bar .labels{position:absolute;inset:0;pointer-events:none;display:flex;align-items:stretch;z-index:3}
    .bar .labels .cell{flex:1;display:flex;align-items:center;justify-content:center;font-weight:700;}

    /* Handle: triangular pointer under the bar */
    .handle{position:absolute;bottom:-34px;transform:translateX(-50%);width:0;height:0;pointer-events:auto;z-index:4}
    .handle .tab{position:absolute;left:50%;transform:translateX(-50%);top:-16px;width:38px;height:16px;background:#141724;border:2px solid #0e1220;border-bottom:none;border-radius:4px 4px 0 0;box-shadow:0 2px 0 rgba(0,0,0,.25)}
    .handle .tip{position:absolute;left:50%;transform:translateX(-50%);top:0;width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-top:24px solid #141724;filter:drop-shadow(0 2px 0 rgba(0,0,0,.25))}
    .handle{cursor:grab}
    .handle[aria-grabbed="true"]{cursor:grabbing}

    /* Ratio textbox under bar */
    .ratio{margin-top:10px;display:flex;justify-content:center}
    .ratio input{width:220px;text-align:center;padding:10px 12px;border-radius:10px;border:1px solid #bbbbbb;background:#ffffff;color:#000000;font-size:32px;font-weight:600}

    /* Divide feature */
    .divideCtrl{margin-top:14px; display:flex; justify-content:center;}
    .dividePanel{margin-top:10px; padding:12px; border:1px solid #e3e6ef; border-radius:12px; background:var(--panel); color:#111;}
    .dividePanel .msg{color:#b00020; font-size:13px;}
    .dividePanel .summary{margin-top:12px;font-weight:700;font-size:28px;color:#1B5E20;text-align:center}

    .foot{color:#555;font-size:12px;text-align:center;margin:10px 0 4px}
    @media (max-width:640px){
      .counter{width:74px}
      .bar{height:52px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Ratio splitter</h1>
    </header>

    <section class="card controls" aria-label="controls">
      <button class="btn primary" id="splitBtn" aria-label="Add one simplest unit to maintain ratio">Split</button>
      <button class="btn" id="regroupBtn" aria-label="Remove one simplest unit (if possible)">Re-group</button>
      <button class="btn" id="resetBtn" aria-label="Reset to one solid bar">Reset</button>
      <div class="info" id="partsInfo">Parts: 1 (max 256)</div>
    </section>

    <section class="card viz" aria-label="visualisation">
      <div class="counters" id="counters">
        <div class="counter-slot" id="leftSlot"><input class="counter" id="leftCount" type="text" value="1" readonly aria-label="Left (blue) count"></div>
        <div class="counter-slot" id="rightSlot"><input class="counter" id="rightCount" type="text" value="0" readonly aria-label="Right (yellow) count"></div>
      </div>

      <div class="barWrap">
        <div class="bar" id="bar" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="1" aria-valuenow="0" aria-label="Right (yellow) partitions">
          <div class="leftFill" id="leftFill" style="width:100%"></div>
          <div class="rightFill" id="rightFill" style="width:0%"></div>
          <div class="lines" id="lines"></div>
          <div class="labels" id="labels"></div>
          <div class="handle" id="handle" aria-grabbed="false" aria-label="Drag to change right side">
            <div class="tab"></div>
            <div class="tip"></div>
          </div>
        </div>
      </div>

      <div class="ratio"><input id="ratioBox" type="text" value="1:0" readonly aria-label="Raw ratio left to right"></div>

      <div class="divideCtrl">
        <button id="divideToggle" class="btn">Divide a quantity into this ratio</button>
      </div>
      <section id="dividePanel" class="dividePanel" hidden>
        <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <label for="divideInput" style="font-weight:600;">Enter number to divide</label>
          <input id="divideInput" type="number" min="1" step="1" inputmode="numeric" pattern="[0-9]*" style="width:140px; padding:6px 10px; border:1px solid #bbb; border-radius:8px;"/>
          <span id="divideMsg" class="msg"></span>
        </div>
        <div id="divideSummary" class="summary"></div>
      </section>

      <div class="foot">Keyboard: ←/→ to move the handle (Shift = ×5). Max total parts: 256.</div>
    </section>
  </div>

<script>
(function(){
  // ----- Utilities -----
  const MAX_PARTS = 256;
  const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));
  const gcd = (a,b)=>{ a=Math.abs(a|0); b=Math.abs(b|0); if(a===0) return b; if(b===0) return a; while(b){ const t=b; b=a%b; a=t; } return a; };
  const round1 = (x)=> Number(x.toFixed(1));

  // ----- State -----
  let parts = 1;        // total partitions (1..MAX)
  let leftCount = 1;    // 0..parts; right = parts - leftCount

  // ----- Elements -----
  const bar = document.getElementById('bar');
  const leftFill = document.getElementById('leftFill');
  const rightFill = document.getElementById('rightFill');
  const lines = document.getElementById('lines');
  const labels = document.getElementById('labels');
  const handle = document.getElementById('handle');
  const splitBtn = document.getElementById('splitBtn');
  const regroupBtn = document.getElementById('regroupBtn');
  const resetBtn = document.getElementById('resetBtn');
  const partsInfo = document.getElementById('partsInfo');
  const ratioBox = document.getElementById('ratioBox');
  const leftCountBox = document.getElementById('leftCount');
  const rightCountBox = document.getElementById('rightCount');
  const leftSlot = document.getElementById('leftSlot');
  const rightSlot = document.getElementById('rightSlot');

  // Divide feature elements
  const divideToggle = document.getElementById('divideToggle');
  const dividePanel = document.getElementById('dividePanel');
  const divideInput = document.getElementById('divideInput');
  const divideMsg = document.getElementById('divideMsg');
  const divideSummary = document.getElementById('divideSummary');

  // ----- Derived helpers -----
  function counts(){ return { L:leftCount, R:parts-leftCount }; }
  function baseUnit(){
    const {L,R} = counts();
    const g = gcd(L,R);
    const a0 = g ? (L/g) : L;
    const b0 = g ? (R/g) : R;
    const S = a0 + b0; // size of one simplest unit in partitions
    return {a0,b0,S,g};
  }

  // ----- Rendering -----
  function updatePartitionLines(){
    lines.innerHTML='';
    for(let i=1;i<parts;i++){
      const v = document.createElement('div');
      v.className='v';
      v.style.left = (i/parts*100)+'%';
      lines.appendChild(v);
    }
  }

  function updateHandle(){
    const pctLeft = (leftCount/parts)*100;
    handle.style.left = pctLeft + '%';
    bar.setAttribute('aria-valuemax', parts);
    bar.setAttribute('aria-valuenow', parts-leftCount);
    leftFill.style.width = pctLeft+'%';
    rightFill.style.width = (100 - pctLeft)+'%';

    const {L,R} = counts();
    leftCountBox.value = L;
    rightCountBox.value = R;
    ratioBox.value = L + ':' + R;

    leftSlot.style.flexBasis = pctLeft+'%';
    rightSlot.style.flexBasis = (100 - pctLeft)+'%';
  }

  function updateButtons(){
    const {a0,b0,S,g} = baseUnit();
    const canSplit = (S>0) && (parts + S <= MAX_PARTS);
    splitBtn.disabled = !canSplit;
    const canRegroup = (g >= 2) && (parts - S >= 1);
    regroupBtn.disabled = !canRegroup;
    partsInfo.textContent = `Parts: ${parts} (max ${MAX_PARTS})`;
  }

  function refresh(){
    updatePartitionLines();
    updateHandle();
    updateButtons();
    updateDivideUI();
  }

  // ----- Interaction: Dragging -----
  function positionToLeftCount(clientX){
    const rect = bar.getBoundingClientRect();
    const x = clamp(clientX - rect.left, 0, rect.width);
    const frac = x / rect.width;
    return clamp(Math.round(frac * parts), 0, parts);
  }

  let dragging = false;
  handle.addEventListener('pointerdown', (e)=>{ e.preventDefault(); handle.setPointerCapture(e.pointerId); dragging = true; handle.setAttribute('aria-grabbed','true'); });
  window.addEventListener('pointerup', ()=>{ if(dragging){ dragging=false; handle.setAttribute('aria-grabbed','false'); }});
  window.addEventListener('pointermove', (e)=>{
    if(!dragging) return;
    leftCount = positionToLeftCount(e.clientX);
    updateHandle();
    updateButtons();
    updateDivideUI();
  });

  bar.addEventListener('pointerdown', (e)=>{
    if(e.target.closest && e.target.closest('#handle')) return;
    leftCount = positionToLeftCount(e.clientX);
    updateHandle();
    updateButtons();
    updateDivideUI();
  });

  // Keyboard support
  bar.addEventListener('keydown', (e)=>{
    const step = e.shiftKey ? 5 : 1;
    if(e.key === 'ArrowLeft'){
      leftCount = clamp(leftCount - step, 0, parts);
      updateHandle();
      updateButtons();
      updateDivideUI();
      e.preventDefault();
    } else if(e.key === 'ArrowRight'){
      leftCount = clamp(leftCount + step, 0, parts);
      updateHandle();
      updateButtons();
      updateDivideUI();
      e.preventDefault();
    }
  });

  // ----- Controls: Split / Re-group / Reset -----
  splitBtn.addEventListener('click', ()=>{
    const {a0,b0,S} = baseUnit();
    if(S>0 && parts + S <= MAX_PARTS){
      leftCount += a0;
      parts += S;
      refresh();
    }
  });

  regroupBtn.addEventListener('click', ()=>{
    const {a0,b0,S,g} = baseUnit();
    if(g >= 2 && parts - S >= 1){
      leftCount -= a0;
      parts -= S;
      leftCount = clamp(leftCount, 0, parts);
      refresh();
    }
  });

  resetBtn.addEventListener('click', ()=>{
    parts = 1; leftCount = 1;
    // Reset divide panel
    divideInput.value = '';
    divideSummary.textContent='';
    divideMsg.textContent='';
    dividePanel.hidden = true;
    labels.innerHTML='';
    refresh();
  });

  window.addEventListener('resize', ()=>{ updateHandle(); updateDivideUI(); });

  // ----- Divide feature -----
  function isDivideOpen(){ return !dividePanel.hasAttribute('hidden'); }
  function validQuantity(){
    const v = Number(divideInput.value);
    if(!Number.isInteger(v) || !(v>0)) return null;
    return v;
  }
  function renderPerPartLabels(total){
    labels.innerHTML='';
    if(parts>64) return; // auto-hide for clarity
    const rect = bar.getBoundingClientRect();
    const cellFont = Math.max(10, Math.min(24, Math.floor((rect.width/parts)*0.45)));
    const q = round1(total/parts);
    for(let i=0;i<parts;i++){
      const cell = document.createElement('div');
      cell.className='cell';
      cell.textContent = q.toFixed(1);
      cell.style.fontSize = cellFont+'px';
      cell.style.color = (i < leftCount) ? '#ffffff' : '#000000';
      labels.appendChild(cell);
    }
  }
  function updateDivideUI(){
    if(!isDivideOpen()){ labels.innerHTML=''; divideSummary.textContent=''; divideMsg.textContent=''; return; }
    const qty = validQuantity();
    if(qty==null){
      divideMsg.textContent = 'Enter a positive whole number.';
      labels.innerHTML='';
      divideSummary.textContent='';
      return;
    }
    divideMsg.textContent = '';
    renderPerPartLabels(qty);
    const L = leftCount, R = parts - leftCount;
    const per = qty/parts;
    const leftVal = round1(per * L);
    const rightVal = round1(qty - leftVal); // Option B: ensure totals match input
    divideSummary.textContent = `${qty} divided into the ratio ${L}:${R} is ${leftVal}:${rightVal}`;
  }

  divideToggle.addEventListener('click', ()=>{
    if(isDivideOpen()) dividePanel.setAttribute('hidden',''); else dividePanel.removeAttribute('hidden');
    updateDivideUI();
  });
  divideInput.addEventListener('input', updateDivideUI);

  // ----- Init -----
  parts = 1; leftCount = 1; // start as 1:0
  refresh();
})();
</script>
</body>
</html>
